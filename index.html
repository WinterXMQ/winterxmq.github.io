
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>落寞纷飞</title>
	<meta name="author" content="WinterXMQ">

	
	<meta name="description" content="system, winwods Comments Windows8.1下管理功能失效 Windows 8.1 下 计算机的管理功能失效了, 按如下方法回复 1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
Windows Registry Editor &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="落寞纷飞" type="application/atom+xml">
	
	<link rel="canonical" href="http://WinterXMQ.github.io/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("winterxmq@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="http://about.me/shashankmehta">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul>

<section class="aboutme">
  <p>
    记录中生活中的点点滴滴, 留下对生命的感悟, 保存曾经的痕迹
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:WinterXMQ@gmail.com" title="Email">Email</a>
		
		
			<a class="facebook" href="http://www.facebook.com/WinterXMQ" title="Facebook">Facebook</a>
		
		
			<a class="google" href="https://plus.google.com/109911271630224770491" rel="author" title="Google+">Google+</a>
		
		
			<a class="twitter" href="http://twitter.com/WinterXMQ" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/WinterXMQ" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner">
<div itemscope itemtype="http://schema.org/Blog">


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-11T16:19:40+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/system/'>system</a>, <a class='category' href='/blog/categories/winwods/'>winwods</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/11/win-manage/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/11/win-manage/" itemprop="url">Windows8.1下管理功能失效</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>Windows 8.1 下 计算机的管理功能失效了, 按如下方法回复</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Windows Registry Editor Version 5.00
</span><span class='line'><span class="o">[</span>HKEY_CLASSES_ROOT<span class="se">\C</span>LSID<span class="se">\{</span>20D04FE0-3AEA-1069-A2D8-08002B30309D<span class="o">}</span><span class="se">\s</span>hell<span class="se">\M</span>anage<span class="o">]</span>
</span><span class='line'>@<span class="o">=</span>hex<span class="o">(</span>2<span class="o">)</span>:40,00,25,00,73,00,79,00,73,00,74,00,65,00,6d,00,72,00,6f,00,6f,00,74,<span class="se">\</span>
</span><span class='line'>00,25,00,5c,00,73,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,6d,00,<span class="se">\</span>
</span><span class='line'>79,00,63,00,6f,00,6d,00,70,00,75,00,74,00,2e,00,64,00,6c,00,6c,00,2c,00,2d,<span class="se">\</span>
</span><span class='line'>00,34,00,30,00,30,00,00,00
</span><span class='line'><span class="s2">&quot;MUIVerb&quot;</span><span class="o">=</span>hex<span class="o">(</span>2<span class="o">)</span>:40,00,25,00,73,00,79,00,73,00,74,00,65,00,6d,00,72,00,6f,00,<span class="se">\</span>
</span><span class='line'>6f,00,74,00,25,00,5c,00,73,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,<span class="se">\</span>
</span><span class='line'>00,6d,00,79,00,63,00,6f,00,6d,00,70,00,75,00,74,00,2e,00,64,00,6c,00,6c,00,<span class="se">\</span>
</span><span class='line'>2c,00,2d,00,34,00,30,00,30,00,00,00
</span><span class='line'><span class="s2">&quot;SuppressionPolicy&quot;</span><span class="o">=</span>dword:4000003c
</span><span class='line'><span class="s2">&quot;HasLUAShield&quot;</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span class='line'><span class="o">[</span>HKEY_CLASSES_ROOT<span class="se">\C</span>LSID<span class="se">\{</span>20D04FE0-3AEA-1069-A2D8-08002B30309D<span class="o">}</span><span class="se">\s</span>hell<span class="se">\M</span>anage<span class="se">\c</span>ommand<span class="o">]</span>
</span><span class='line'>@<span class="o">=</span>hex<span class="o">(</span>2<span class="o">)</span>:25,00,77,00,69,00,6e,00,64,00,69,00,72,00,25,00,5c,00,73,00,79,00,73,<span class="se">\</span>
</span><span class='line'>00,74,00,65,00,6d,00,33,00,32,00,5c,00,6d,00,6d,00,63,00,2e,00,65,00,78,00,<span class="se">\</span>
</span><span class='line'>65,00,20,00,2f,00,73,00,20,00,25,00,77,00,69,00,6e,00,64,00,69,00,72,00,25,<span class="se">\</span>
</span><span class='line'>00,5c,00,73,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,63,00,6f,00,<span class="se">\</span>
</span><span class='line'>6d,00,70,00,6d,00,67,00,6d,00,74,00,2e,00,6d,00,73,00,63,00,00,00
</span></code></pre></td></tr></table></div></figure>


<p>参考</p>

<blockquote><p>[1] <a href="http://zhidao.baidu.com/link?url=BryEHZL7x2RGquDoxt1F4Z1NPPVmiFs9wMFd7Ny7HGiNECA9Dxedr84IKhe8rBu87V6dohBs6HRmzfw0kXZq7NRSlO2NcT3OuwdVtYBTBce">百度知道</a></p></blockquote>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-10T14:13:44+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/archlinux/'>archlinux</a>, <a class='category' href='/blog/categories/ext4/'>ext4</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/lvm/'>lvm</a>, <a class='category' href='/blog/categories/vbox/'>vbox</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/10/extend-volume/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/10/extend-volume/" itemprop="url">ArchLinux上磁盘扩展</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>问题: 在VBox上创建ArchLinux虚拟机的时候就想着如果硬盘不够用, 就到时候再想办法扩容, 因此当时就只搞了8G的硬盘, 其中还有1G的Swap分区; 没想到这个问题这么快就出现了, 因此就有了一下的解决方案</p>

<p>问题分析:</p>

<p>由于虚拟磁盘采用的是 <code>VirtualBox Disk Image</code>, 同时在ArchLinux中没有逻辑磁盘(LVM)还有就是就是系统只有单个分区, 所以不适合采用另加磁盘的挂载方式来解决。</p>

<p>问题解决方案:</p>

<p>总体方案: 给 <code>/</code> 分区扩容, 分两步, 1) 先给虚拟磁盘扩容; 2) 再想办法给 <code>/</code> 分区扩容</p>

<h1>VBox 的虚拟磁盘扩容</h1>

<p>在 VBox 中有一个管理工具可以对磁盘扩容, 支持命令行, 操作更加简便</p>

<p>查看 VBox 下注册的虚拟磁盘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; VBoxManage list hdds
</span><span class='line'>UUID:           a314bb2f-c879-4e1d-9669-251a5e49f54f
</span><span class='line'>Parent UUID:    base
</span><span class='line'>State:          locked write
</span><span class='line'>Type:           normal <span class="o">(</span>base<span class="o">)</span>
</span><span class='line'>Location:       C:<span class="se">\O</span>S<span class="se">\A</span>rch_Box<span class="se">\A</span>rchV.vdi
</span><span class='line'>Storage format: VDI
</span><span class='line'>Capacity:       <span class="m">20480</span> MBytes
</span></code></pre></td></tr></table></div></figure>


<p>便可得到磁盘的UUID为 a314bb2f-c879-4e1d-9669-251a5e49f54f</p>

<p>使用磁盘的UUID给磁盘扩容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; VBoxManage modifyhd a314bb2f-c879-4e1d-9669-251a5e49f54f --resize 20480
</span></code></pre></td></tr></table></div></figure>


<p>此时磁盘中被扩展的那部分空间还没被分配, 需要在系统中操作</p>

<h1>分区扩展</h1>

<p>虽然说ext4分区的收缩和扩展技术是成熟的, 但由于之前的分区是老版的cfdisk创建的, 引导区的大小是62个扇区, 分区是从63扇区开始的, 而现在所有的Linux上的工具都默认从2048个扇区开始分配空间, 因此会造成根分区被删除后重建时, 分区上的数据信息会丢失, 目前对此没有找到可行的方案; 因此采用如下方案, 同时也会记录原方案, 方便以后对2,3,4分区的扩展; 采用的方案是: 采用Linux的逻辑卷(LVM)的管理办法。</p>

<h2>LVM解决方案</h2>

<p>简单的说就是重构现在的磁盘结构, 全面换成LVM磁盘</p>

<p>(1) 创建一个新磁盘, 和安装盘一起连接到虚拟机上, 重启, 进入安装系统</p>

<p>(2) 开始新磁盘的分区操作</p>

<p>由于要采用LVM的磁盘管理办法, 首先要对安装系统做如下操作</p>

<p>安装lvm2</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; pacman -Syy
</span><span class='line'>&gt;&gt; pacman -S lvm2
</span></code></pre></td></tr></table></div></figure>


<p>加载 dm_mod</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; modprobe dm_mod
</span></code></pre></td></tr></table></div></figure>


<p>物理分区, 和以前一样, 这次采用fdisk来处理</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; fdisk /dev/sdb
</span><span class='line'>Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: n
</span><span class='line'>Partition <span class="nb">type</span>:
</span><span class='line'>   p   primary <span class="o">(</span><span class="m">0</span> primary, <span class="m">0</span> extended, <span class="m">4</span> free<span class="o">)</span>
</span><span class='line'>   e   extended
</span><span class='line'>Select <span class="o">(</span>default p<span class="o">)</span>: p
</span><span class='line'>Partition number <span class="o">(</span>1-4, default 1<span class="o">)</span>: 1
</span><span class='line'>First sector <span class="o">(</span>2048-41943039, default 2048<span class="o">)</span>:
</span><span class='line'>Last sector, +sectors or +size<span class="o">{</span>K,M,G,T,P<span class="o">}</span> <span class="o">(</span>2048-41943039, default 41943039<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>Created a new partition <span class="m">1</span> of <span class="nb">type</span> <span class="s1">&#39;Linux&#39;</span> and of size <span class="m">20</span> GiB.
</span><span class='line'>
</span><span class='line'>Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: t
</span><span class='line'>Selected partition 1
</span><span class='line'>Hex code <span class="o">(</span><span class="nb">type </span>L to list all codes<span class="o">)</span>: 8e
</span><span class='line'>Changed <span class="nb">type </span>of partition <span class="s1">&#39;Linux&#39;</span> to <span class="s1">&#39;Linux LVM&#39;</span>.
</span><span class='line'>
</span><span class='line'>Command <span class="o">(</span>m <span class="k">for</span> <span class="nb">help</span><span class="o">)</span>: w
</span><span class='line'>The partition table has been altered.
</span><span class='line'>Calling ioctl<span class="o">()</span> to re-read partition table.
</span><span class='line'>Syncing disks.
</span><span class='line'>
</span><span class='line'>&gt;&gt; fdisk -l /dev/sdb
</span><span class='line'>
</span><span class='line'>Disk /dev/sdb: <span class="m">20</span> GiB, <span class="m">21474836480</span> bytes, <span class="m">41943040</span> sectors
</span><span class='line'>Units: sectors of <span class="m">1</span> * <span class="nv">512</span> <span class="o">=</span> <span class="m">512</span> bytes
</span><span class='line'>Sector size <span class="o">(</span>logical/physical<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span><span class='line'>I/O size <span class="o">(</span>minimum/optimal<span class="o">)</span>: <span class="m">512</span> bytes / <span class="m">512</span> bytes
</span><span class='line'>Disklabel <span class="nb">type</span>: dos
</span><span class='line'>Disk identifier: 0x00000000
</span><span class='line'>
</span><span class='line'>Device    Boot Start       End   Blocks  Id System
</span><span class='line'>/dev/sdb1       <span class="m">2048</span>  <span class="m">41943039</span> <span class="m">20970496</span>  8e Linux LVM
</span></code></pre></td></tr></table></div></figure>


<p>开始设置LVM磁盘系统</p>

<p>创建物理卷 Physical Volume</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; pvcreate /dev/sdb1
</span><span class='line'>&gt;&gt; pvdisplay
</span><span class='line'>--- Physical volume ---
</span><span class='line'>  PV Name               /dev/sda1
</span><span class='line'>  VG Name               root
</span><span class='line'>  PV Size               20.00 GiB / not usable 3.00 MiB
</span><span class='line'>  Allocatable           yes <span class="o">(</span>but full<span class="o">)</span>
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              5119
</span><span class='line'>  Free PE               0
</span><span class='line'>  Allocated PE          5119
</span><span class='line'>  PV UUID               BduFVm-tKMn-JDPf-b1U8-vcs8-8YDk-FNsW0e
</span></code></pre></td></tr></table></div></figure>


<p>创建卷组 Volume Group</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; vgcreate root /dev/sdb1
</span><span class='line'>&gt;&gt; vgdisplay
</span><span class='line'>  --- Volume group ---
</span><span class='line'>  VG Name               root
</span><span class='line'>  System ID
</span><span class='line'>  Format                lvm2
</span><span class='line'>  Metadata Areas        1
</span><span class='line'>  Metadata Sequence No  2
</span><span class='line'>  VG Access             <span class="nb">read</span>/write
</span><span class='line'>  VG Status             resizable
</span><span class='line'>  MAX LV                0
</span><span class='line'>  Cur LV                1
</span><span class='line'>  Open LV               1
</span><span class='line'>  Max PV                0
</span><span class='line'>  Cur PV                1
</span><span class='line'>  Act PV                1
</span><span class='line'>  VG Size               20.00 GiB
</span><span class='line'>  PE Size               4.00 MiB
</span><span class='line'>  Total PE              5119
</span><span class='line'>  Alloc PE / Size       <span class="m">5119</span> / 20.00 GiB
</span><span class='line'>  Free  PE / Size       <span class="m">0</span> / 0
</span><span class='line'>  VG UUID               kROehq-qYhI-U21s-Guaq-FFns-bv3R-8cIzDA
</span></code></pre></td></tr></table></div></figure>


<p>创建逻辑卷 Logical Volume, 及以后操作的卷</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; lvcreate -l +100%FREE root -n root
</span><span class='line'>&gt;&gt; lvdisplay
</span><span class='line'>  --- Logical volume ---
</span><span class='line'>  LV Path                /dev/root/root
</span><span class='line'>  LV Name                root
</span><span class='line'>  VG Name                root
</span><span class='line'>  LV UUID                YtEeaf-sqJJ-8VAq-MdYo-es8Q-uTtO-QulEHJ
</span><span class='line'>  LV Write Access        <span class="nb">read</span>/write
</span><span class='line'>  LV Creation host, <span class="nb">time </span>archiso, 2014-11-10 03:41:50 +0000
</span><span class='line'>  LV Status              available
</span><span class='line'>  <span class="c"># open                 1</span>
</span><span class='line'>  LV Size                20.00 GiB
</span><span class='line'>  Current LE             5119
</span><span class='line'>  Segments               1
</span><span class='line'>  Allocation             inherit
</span><span class='line'>  Read ahead sectors     auto
</span><span class='line'>  - currently <span class="nb">set </span>to     256
</span><span class='line'>  Block device           254:0
</span></code></pre></td></tr></table></div></figure>


<p>(3) 磁盘格式化, 选定磁盘系统(和以前一样)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; mkfs.ext4 /dev/mapper/root-root
</span></code></pre></td></tr></table></div></figure>


<p>(4) 拷贝数据(不建议挂载磁盘后用cp命令来执行, 建议采用如下命令完成, 虽然步骤有点多, 但胜在可靠)</p>

<p>采用 <code>dd</code> 来镜像拷贝磁盘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; dd <span class="k">if</span><span class="o">=</span>/dev/sda1 <span class="nv">of</span><span class="o">=</span>/dev/mapper/root-root
</span></code></pre></td></tr></table></div></figure>


<p>这时候你用 <code>df -h</code> 去查看 <code>/dev/mapper/root-root</code> 的容量时会发现 <code>/dev/mapper/root-root</code> 的磁盘大小和 <code>/dev/sda1</code> 的是一样的, 由于拷贝的时候连同分区表信息都一起拷贝过来了(这个问题还是在正式进入系统后才发现的), 需要做如下处理来扩展磁盘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; resize2fs /dev/mapper/root-root 20476M
</span></code></pre></td></tr></table></div></figure>


<p>(5) 新系统设置</p>

<p>生成新的分区表信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; genfstab -U -p /mnt
</span></code></pre></td></tr></table></div></figure>


<p>把生成的信息写入 <code>/etc/fstab</code>, 删除以前的分区信息</p>

<p>进入新系统</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; arch-chroot /mnt/new /bin/zsh
</span></code></pre></td></tr></table></div></figure>


<p>设置系统内核, 配合LVM文件系统</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; vim /etc/mkinitcpio.conf
</span></code></pre></td></tr></table></div></figure>


<p>确保 udev 和 lvm2 被 mkinitcpio 加载, 确保 lvm2 在 block 和 filesystem 之间</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">HOOKS</span><span class="o">=</span><span class="s2">&quot;base udev ... block lvm2 filesystems&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以及确保 dm-mod 被加载</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">MODULES</span><span class="o">=</span><span class="s2">&quot;dm_mod ...&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>安装系统引导</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; grub-install --modules<span class="o">=</span>lvm --target<span class="o">=</span>i386-pc --recheck /dev/sda
</span></code></pre></td></tr></table></div></figure>


<p>会出现如下错误, 是由于/run在arch-chroot环境下不可用导致的, 但不会影响正常安装</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  /run/lvm/lvmetad.socket: connect failed: No such file or directory
</span><span class='line'>  WARNING: Failed to connect to lvmetad. Falling back to internal scanning.
</span></code></pre></td></tr></table></div></figure>


<p>更新grub列表</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; grub-mkconfig -o /boot/grub/grub.cfg
</span></code></pre></td></tr></table></div></figure>


<p>在正式进入系统后, 再重新执行一边</p>

<h2>Basic 解决方案</h2>

<p>简单的来说就是基于基本磁盘的收缩和扩容方案, 这个方法在这里不适用的原因是前后引导区的大小不一致(扩容时需要把分区删掉重建, 由于删除重建前后的引导区大小不一致, 使得分区起始位置不同, 而导致的分区信息丢失, 磁盘类别不可识别, 引起扩容失败), 但对于第2, 3, 4分区的扩容以及引导分区大小不会变化的磁盘, 此方案可行, 已测试过</p>

<p>(1) 收缩磁盘</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; resize2fs /dev/sdaX size
</span></code></pre></td></tr></table></div></figure>


<p>注意: 1) size 小于实际分区大小且大于已用大小; 2) 此命令可能造成数据丢失, 谨慎操作; 3) 操作前, 可用 <code>e2fsck -f /dev/sdaX</code> 强制检查磁盘</p>

<p>(2) 扩充磁盘</p>

<p>采用 <code>fdisk /dev/sdaX</code> 来删除重建分区, 只要初始位置不变, 容量扩大, 不必担心删除时数据丢失, 之后再适用上条命令完成磁盘扩容</p>

<h1>参考</h1>

<blockquote><p>[1] <a href="http://www.2cto.com/os/201306/222822.html">http://www.2cto.com/os/201306/222822.html</a></p>

<p>[2] <a href="https://wiki.archlinux.org/index.php/Lvm">https://wiki.archlinux.org/index.php/Lvm</a></p>

<p>[3] <a href="http://www.byywee.com/page/M0/S834/834847.html">http://www.byywee.com/page/M0/S834/834847.html</a></p>

<p>[4] <a href="http://bbs.chinaunix.net/thread-1972006-1-1.html">http://bbs.chinaunix.net/thread-1972006-1-1.html</a></p>

<p>[5] <a href="http://linux.cn/article-3218-1.html">http://linux.cn/article-3218-1.html</a></p></blockquote>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-09T06:07:30+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/archlinux/'>archlinux</a>, <a class='category' href='/blog/categories/aur/'>aur</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/yaourt/'>yaourt</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/09/yaourt/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/09/yaourt/" itemprop="url">Arch Linux 安装Aur包管理器Yaourt</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>(1) 安装Yourt包管理器, 首先添加软件源, <code>sudo vim /etc/pacman.conf</code>, 在文件尾增加如下内容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>archlinuxcn<span class="o">]</span>
</span><span class='line'><span class="c"># The Chinese Arch Linux communities packages.</span>
</span><span class='line'><span class="nv">SigLevel</span> <span class="o">=</span> Optional TrustAll
</span><span class='line'><span class="nv">Server</span>   <span class="o">=</span> http://repo.archlinuxcn.org/<span class="nv">$arch</span>
</span></code></pre></td></tr></table></div></figure>


<p>(2) 更新缓存, <code>sudo pacman -Syy</code></p>

<p>(3) 安装Yourt, <code>sudo pacman -S yaourt</code></p>

<p>(4) 安装Aurvote, <code>sudo pacman -S aurvote</code></p>

<p>(5) 配置aurvote, <code>aurvote --configure</code></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-08T16:10:51+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/archlinux/'>archlinux</a>, <a class='category' href='/blog/categories/ftp/'>ftp</a>, <a class='category' href='/blog/categories/linux/'>linux</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/08/ftp-setup/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/08/ftp-setup/" itemprop="url">Arch Linux 下FTP服务器的搭建</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>为了方便BBS测试的文件上传, 就此搭建FTP服务器</p>

<h1>Install</h1>

<p>安装 <code>vsftpd</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo pacman -S vsftpd
</span></code></pre></td></tr></table></div></figure>


<p>启动 vsftpd 和 设置开机自启</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo systemctl <span class="nb">enable </span>vsftpd
</span><span class='line'>&gt;&gt; sudo systemctl start vsftpd
</span></code></pre></td></tr></table></div></figure>


<h1>Configuration</h1>

<p>大多数的设置在 <code>/etc/vsftpd.conf</code>, 打开配置文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo vim /etc/vsftpd.conf
</span></code></pre></td></tr></table></div></figure>


<p>启用上传功能, <code>write_enable=YES</code></p>

<p>开启本地用户登录功能, <code>local_enable=YES</code></p>

<p>开启IPV6支持</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">listen</span><span class="o">=</span>NO
</span><span class='line'><span class="nv">listen_ipv6</span><span class="o">=</span>YES
</span></code></pre></td></tr></table></div></figure>


<p>自定义端口, 增加配置 <code>listen_port=2211</code>, 打开防火墙</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>iptables -A INPUT -m state --state NEW -m tcp -p tcp --dport <span class="m">2211</span> -j ACCEPT
</span></code></pre></td></tr></table></div></figure>


<p>增加用户设置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo htpasswd -c /etc/vsftpd/.passwd Username
</span><span class='line'>New password:
</span><span class='line'>Re-type new password:
</span></code></pre></td></tr></table></div></figure>


<p>若以后想增加用户, 可以使用 <code>sudo htpasswd /etc/vsftpd/.passwd Username</code></p>

<p>这种方式增加的用户应该是不能被认证的, 用如下命令生成的密码替换</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; openssl passwd -1
</span></code></pre></td></tr></table></div></figure>


<p>向PAM service注册认证数据库, <code>sudo vim /etc/pam.d/vsftpd</code>, 并增加如下内容</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>auth required pam_pwdfile.so pwdfile /etc/vsftpd/.passwd
</span><span class='line'>account required pam_permit.so
</span></code></pre></td></tr></table></div></figure>


<p>同时需要安装PAM对pwdfile的认证支持库, <code>sudo yaout pam_pwdfile</code>, Yaourt的安装见<a href="/blog/2014/11/09/yaourt/">Arch Linux 安装Aur包管理器Yaourt</a></p>

<p>在系统中增加ftp虚拟用户</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo useradd -d /srv/ftp -s/usr/bin/nologin -G ftp -M ftp
</span></code></pre></td></tr></table></div></figure>


<p>更改文件夹的所有人, <code>sudo chown -R ftp:ftp /srv/ftp</code></p>

<p>配置文件里增加如下信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># pointing to the correct PAM service file</span>
</span><span class='line'><span class="nv">pam_service_name</span><span class="o">=</span>vsftpd
</span><span class='line'><span class="nv">write_enable</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">hide_ids</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">listen</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">connect_from_port_20</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">anonymous_enable</span><span class="o">=</span>NO
</span><span class='line'><span class="nv">local_enable</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">dirmessage_enable</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">xferlog_enable</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">chroot_local_user</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">guest_enable</span><span class="o">=</span>YES
</span><span class='line'><span class="nv">guest_username</span><span class="o">=</span>virtual
</span><span class='line'><span class="nv">virtual_use_local_privs</span><span class="o">=</span>YES
</span></code></pre></td></tr></table></div></figure>


<p>在用的过程中发现 FTP 不支持软链接的方式, 因此换成mount的方式来实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo mount --bind /path/to/source /srv/ftp/
</span></code></pre></td></tr></table></div></figure>


<p>接着重启vsftpd服务器就行了</p>

<h1>参考</h1>

<blockquote><p>(1) <a href="https://wiki.archlinux.org/index.php/Very_Secure_FTP_Daemon">https://wiki.archlinux.org/index.php/Very_Secure_FTP_Daemon</a></p>

<p>(2) <a href="http://www.cnblogs.com/acpp/archive/2010/02/08/1665876.html">http://www.cnblogs.com/acpp/archive/2010/02/08/1665876.html</a></p>

<p>(3) <a href="http://blog.chinaunix.net/uid-26263042-id-3230479.html">http://blog.chinaunix.net/uid-26263042-id-3230479.html</a></p></blockquote>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-04T14:29:56+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/apache/'>apache</a>, <a class='category' href='/blog/categories/discuz/'>discuz</a>, <a class='category' href='/blog/categories/linux/'>linux</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/04/test-for-bbs/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/04/test-for-bbs/" itemprop="url">BBS的本地测试环境的搭建</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>本地环境的LAMP环境安装见<a href="/blog/2014/10/28/lamp/">ArchLinux上搭建LAMP环境</a></p>

<p>这个地方主要讲bbs的备份和本地还原</p>

<h1>服务器备份</h1>

<p>文档数据的备份</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; <span class="nb">cd</span> /var/www
</span><span class='line'>&gt;&gt; tar czvf sns-data.tar.gz sns/
</span></code></pre></td></tr></table></div></figure>


<p>数据库的备份</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; mysqldump -hHOSTNAME -uUSER -pPASSWORD DATABASENAME &gt; sns-date.sql
</span><span class='line'>&gt;&gt; du -h sns-date.sql       <span class="p">;</span> 查看文件大小
</span></code></pre></td></tr></table></div></figure>


<h1>本地还原</h1>

<p>文档数据还原</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; rm -rf /srv/http/*
</span><span class='line'>&gt;&gt; tar zxvf sns-date.tar.gz -C /srv/http/sns
</span></code></pre></td></tr></table></div></figure>


<p>数据库还原</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; mysql -uUSER -p
</span><span class='line'>mysql&gt; create database <span class="sb">`</span>sns<span class="sb">`</span><span class="p">;</span>
</span><span class='line'>mysql&gt; <span class="nb">exit</span>
</span><span class='line'>Bye
</span><span class='line'>&gt;&gt; mysql -uUSER -p sns &lt; sns-date.sql
</span></code></pre></td></tr></table></div></figure>


<h1>本地配置</h1>

<p>(1) 虚拟主机配置</p>

<p>以ArchLinux为例, apache是ArchLinux的默认安装</p>

<p>打开配置文件, <code>sudo vim /etc/httpd/conf/extra/httpd-vhosts.conf</code>, 做如下修改</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;VirtualHost *:80&gt;
</span><span class='line'>    DocumentRoot <span class="s2">&quot;/srv/http/sns&quot;</span>
</span><span class='line'>    ServerName <span class="s2">&quot;bbs.winterxq.me&quot;</span>
</span><span class='line'>    &lt;Directory <span class="s2">&quot;/srv/http/sns&quot;</span>&gt;
</span><span class='line'>        Options Indexes FollowSymLinks
</span><span class='line'>        AllowOverride None
</span><span class='line'>        Order allow,deny
</span><span class='line'>        Allow from all
</span><span class='line'>    &lt;/Directory&gt;
</span><span class='line'>&lt;/VirtualHost&gt;
</span></code></pre></td></tr></table></div></figure>


<p>重启服务, <code>sudo systemctl restart httpd</code></p>

<p>(2) 设置apache和mysql的开机自启</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo systemctl <span class="nb">enable </span>httpd
</span><span class='line'>&gt;&gt; sudo systemctl <span class="nb">enable </span>mysqld
</span></code></pre></td></tr></table></div></figure>


<p>(3) 设置文件夹所有权</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo chown -R http:http data/
</span><span class='line'>&gt;&gt; sudo chown -R http:http config/
</span><span class='line'>&gt;&gt; sudo chown -R http:http uc_server/data/
</span><span class='line'>&gt;&gt; sudo chown -R http:http uc_client/data/cache/
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-11-04T11:21:09+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/cmd/'>cmd</a>, <a class='category' href='/blog/categories/system/'>system</a>, <a class='category' href='/blog/categories/windows/'>windows</a>


</div>
		
			<span class="comments"><a href="/blog/2014/11/04/windows-mklink/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/11/04/windows-mklink/" itemprop="url">Windows下的硬链接、软连接和快捷方式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>很久以前记得Windows下是没有硬链接、软连接这个功能的, 前段时间, 在关注Windows的WinSxS的时候, 有篇文章提到硬链接时才去查阅后才发现Windows支持这个特性了</p>

<p>在一些相关的资料中表明, Windows的这项特性其实很早就存在了, 只是不为别人所知, 在Win7的WinSxS中应用了这个技术, 使得我们以为这个是个新技术, 其实在XP中以及支持这一特性了</p>

<blockquote><p><strong>注意点:</strong></p>

<p>  (1) Windows的链接技术只支持NTFS文件系统</p>

<p>  (2) 硬链接不能跨卷, 简单的说不能把C盘的文件链接到D盘</p>

<p>  (3) 软链接和符号链接不能跨磁盘</p></blockquote>

<h1>三种文件夹的异同</h1>

<p>主要关注 <code>硬链接</code> 和 <code>软连接</code></p>

<p>1) Symbolic Link(符号链接)</p>

<ul>
<li>图标与快捷方式很像</li>
<li>在系统中不占用空间</li>
<li>在文件系统中不是独立文件</li>
<li>在操作系统层解析</li>
<li>源文件丢失, 链接失效</li>
<li>两者互不影响</li>
</ul>


<p>2) Hard Link(硬链接)</p>

<ul>
<li>占用同一个空间, 引用同一个对象(不是拷贝)</li>
<li>在操作系统层解析</li>
<li>移除硬链接, 源文件不受影响</li>
<li>源文件移除, 硬链接不受影响</li>
<li>两者修改的是同一份文件</li>
</ul>


<p>3) Shortcut(快捷方式)</p>

<h1>Windows XP 下的实现</h1>

<p>文件硬链接的实现</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; fsutil hardlink create newFileName fileName
</span></code></pre></td></tr></table></div></figure>


<p>文件夹的硬链接实现, 通过 <code>junction.exe</code> 来实现, 具体程序网上下载</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; junction.exe Link Target     // 创建硬链接
</span><span class='line'>&gt;&gt; junction.exe target /d       // 删除文件夹
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意:</strong></p>

<p> 1) 创建文件夹硬连接, 这个可以跨分区</p>

<p> 2) 删除硬链接必须使用 <code>junction 文件夹连接名 /d</code>, 否则会删掉源文件</p>

<h1>Vista, Windows 7及以上版本下的实现</h1>

<p>使用 <code>mklink</code> 来实现, 功能比 <code>fsutil</code> 强多了</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; mklink
</span><span class='line'>MKLINK <span class="o">[[</span>/D<span class="o">]</span> <span class="p">|</span> <span class="o">[</span>/H<span class="o">]</span> <span class="p">|</span> <span class="o">[</span>/J<span class="o">]]</span> Link Target
</span><span class='line'>
</span><span class='line'>        /D      Creates a directory symbolic link.  Default is a file
</span><span class='line'>                symbolic link.
</span><span class='line'>        /H      Creates a hard link instead of a symbolic link.
</span><span class='line'>        /J      Creates a Directory Junction.
</span><span class='line'>        Link    specifies the new symbolic link name.
</span><span class='line'>        Target  specifies the path <span class="o">(</span>relative or absolute<span class="o">)</span> that the new link
</span><span class='line'>                refers to.
</span></code></pre></td></tr></table></div></figure>


<p>简单的说:</p>

<ul>
<li>/D 创建目录符号链接, 默认为文件符号链接</li>
<li>/H 创建硬链接</li>
<li>/J 创建目录联接</li>
</ul>


<h1>第三方工具 Link Shell Extension</h1>

<p>在Windows下点击操作完成文件夹链接的工具<a href="%22http://www.schina.priv.at/nt/hardlinkshellext/hardlinkshellext.html%22" title="Link Shell Extension 官网">Link Shell Extension</a></p>

<p>这个工具对文件夹可以完成以下7个功能: 1) Symbolic Link 2) Junction 3) Smart Copy 4) Smart Mirror 5) DeLorean Copy 6) Hardlink Clone 7) Symbolic Link Clone</p>

<p>每个功能的具体看这个工具的官网说明</p>

<h1>参考</h1>

<p>1) <a href="http://www.cnblogs.com/heqichang/archive/2012/04/26/241774.html">http://www.cnblogs.com/heqichang/archive/2012/04/26/241774.html</a></p>

<p>2) <a href="http://chenkegarfield.blog.163.com/blog/static/62330008201231153049164/">http://chenkegarfield.blog.163.com/blog/static/62330008201231153049164/</a></p>

<p>3) <a href="http://blog.csdn.net/wzy0623/article/details/3596572">http://blog.csdn.net/wzy0623/article/details/3596572</a></p>

<p>4) <a href="http://www.cnblogs.com/plusium/archive/2010/03/17/1688511.html">http://www.cnblogs.com/plusium/archive/2010/03/17/1688511.html</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-31T12:18:44+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/regular-expression/'>regular-expression</a>, <a class='category' href='/blog/categories/shell/'>shell</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/31/shell-regular/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/31/shell-regular/" itemprop="url">Linux中的正则表达式</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>POSIX<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup> 定义了两种正则表达式语法:</p>

<p>1) BRE 基本正则表达式(Basic Regular Expression);</p>

<p>2) ERE 扩展的正则表达式(Extended Regular Expression)</p>

<p>大多数的Linux程序符合BRE规则</p>

<p><code>sed</code> 只支持大部分 BRE, 因为主要是受到速度的限制;</p>

<p><code>grep</code> 可以支持 ERE, 只是需要增加额外参数 <code>-E</code></p>

<p><code>gwak</code> 使用 BRE</p>

<h1>Regular Expression 中的基本字符集</h1>

<p>BRE定义语法符号</p>

<table>
<thead>
<tr>
<th style="text-align:left;">符号    </th>
<th style="text-align:left;"> 模式含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">. </td>
<td style="text-align:left;"> 匹配任何一个字符</td>
</tr>
<tr>
<td style="text-align:left;">[] </td>
<td style="text-align:left;"> 字符集匹配</td>
</tr>
<tr>
<td style="text-align:left;">[^] </td>
<td style="text-align:left;"> 字符集(取反)匹配</td>
</tr>
<tr>
<td style="text-align:left;">^ </td>
<td style="text-align:left;"> 匹配开始位置</td>
</tr>
<tr>
<td style="text-align:left;">$ </td>
<td style="text-align:left;"> 匹配结束位置</td>
</tr>
<tr>
<td style="text-align:left;">() </td>
<td style="text-align:left;"> 定义子表达式</td>
</tr>
<tr>
<td style="text-align:left;">\n </td>
<td style="text-align:left;"> 子表达式向前引用, 即表示重复, n在{1,9}之间</td>
</tr>
<tr>
<td style="text-align:left;">* </td>
<td style="text-align:left;"> 多次或者重复匹配(包括0次重复)</td>
</tr>
<tr>
<td style="text-align:left;">\ </td>
<td style="text-align:left;"> 转义符</td>
</tr>
<tr>
<td style="text-align:left;">[] </td>
<td style="text-align:left;"> 匹配括号内出现的字符, 如 [a-zA-Z0123]</td>
</tr>
<tr>
<td style="text-align:left;">p{n} </td>
<td style="text-align:left;"> 匹配p出现n次</td>
</tr>
<tr>
<td style="text-align:left;">p{n,} </td>
<td style="text-align:left;"> 匹配p至少出现n次</td>
</tr>
<tr>
<td style="text-align:left;">p{n,m} </td>
<td style="text-align:left;"> 匹配所有p出现的次数大于n小于m的情况</td>
</tr>
</tbody>
</table>


<p>ERE修改的语法符号</p>

<table>
<thead>
<tr>
<th style="text-align:left;">符号 </th>
<th style="text-align:center;"> 状态 </th>
<th style="text-align:left;"> 模式含义</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">? </td>
<td style="text-align:center;"> 新增 </td>
<td style="text-align:left;"> 多次匹配(包括0次)</td>
</tr>
<tr>
<td style="text-align:left;">+ </td>
<td style="text-align:center;"> 新增 </td>
<td style="text-align:left;"> 至少一次匹配</td>
</tr>
<tr>
<td style="text-align:left;"></td>
<td style="text-align:center;"> </td>
<td style="text-align:left;"> 新增 | 或运算, 匹配两个子表达式的合集</td>
</tr>
<tr>
<td style="text-align:left;">() /{m,n} </td>
<td style="text-align:center;"> 修改 </td>
<td style="text-align:left;"> <strong>注释:</strong> 不需要转义 (, ), {, } 这些符号</td>
</tr>
<tr>
<td style="text-align:left;">\n </td>
<td style="text-align:center;"> 取消 </td>
<td style="text-align:left;"> &hellip;&hellip;</td>
</tr>
</tbody>
</table>


<p>BRE 和 ERE 共享, 额外的一些定义:</p>

<p>特殊符号:</p>

<p>表一:</p>

<table>
<thead>
<tr>
<th style="text-align:left;">POSIX类 </th>
<th style="text-align:center;"> perl类 </th>
<th style="text-align:left;"> 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">[:alnum:] </td>
<td style="text-align:center;">    </td>
<td style="text-align:left;"> 数字集+字母集</td>
</tr>
<tr>
<td style="text-align:left;">[:alpha:] </td>
<td style="text-align:center;"> \a </td>
<td style="text-align:left;"> 字母集</td>
</tr>
<tr>
<td style="text-align:left;">[:lower:] </td>
<td style="text-align:center;"> \l </td>
<td style="text-align:left;"> 小写字母集</td>
</tr>
<tr>
<td style="text-align:left;">[:upper:] </td>
<td style="text-align:center;"> \u </td>
<td style="text-align:left;"> 大写字母集</td>
</tr>
<tr>
<td style="text-align:left;">[:blank:] </td>
<td style="text-align:center;">    </td>
<td style="text-align:left;"> 空白字符集(空格+制表符)</td>
</tr>
<tr>
<td style="text-align:left;">[:space:] </td>
<td style="text-align:center;"> \s </td>
<td style="text-align:left;"> 所有空白字符(包括[:blank:])</td>
</tr>
<tr>
<td style="text-align:left;">[:cntrl:] </td>
<td style="text-align:center;">    </td>
<td style="text-align:left;"> 不可打印的控制字符集(退格, 删除&hellip;.)</td>
</tr>
<tr>
<td style="text-align:left;">[:digit:] </td>
<td style="text-align:center;"> \d </td>
<td style="text-align:left;"> 十进制数字</td>
</tr>
<tr>
<td style="text-align:left;">[:xdigit:] </td>
<td style="text-align:center;"> \x </td>
<td style="text-align:left;"> 十六进制数字</td>
</tr>
<tr>
<td style="text-align:left;">[:graph:] </td>
<td style="text-align:center;">    </td>
<td style="text-align:left;"> 可打印的非空白字符</td>
</tr>
<tr>
<td style="text-align:left;">[:print:] </td>
<td style="text-align:center;"> \p </td>
<td style="text-align:left;"> 可打印的字符</td>
</tr>
<tr>
<td style="text-align:left;">[:pumct:] </td>
<td style="text-align:center;">    </td>
<td style="text-align:left;"> 标点符号</td>
</tr>
</tbody>
</table>


<p>表二:</p>

<table>
<thead>
<tr>
<th style="text-align:center;">perl类 </th>
<th style="text-align:left;"> 等效POSIX </th>
<th style="text-align:left;"> 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">\o </td>
<td style="text-align:left;"> [0-7] </td>
<td style="text-align:left;"> 八进制数字</td>
</tr>
<tr>
<td style="text-align:center;">\O </td>
<td style="text-align:left;"> [^0-7] </td>
<td style="text-align:left;"> 非八进制</td>
</tr>
<tr>
<td style="text-align:center;">\w </td>
<td style="text-align:left;"> [[:alnum:]] </td>
<td style="text-align:left;"> 单词</td>
</tr>
<tr>
<td style="text-align:center;">\W </td>
<td style="text-align:left;"> [^[:alnum:]] </td>
<td style="text-align:left;"> 非单词</td>
</tr>
<tr>
<td style="text-align:center;">\A </td>
<td style="text-align:left;"> [^[:alphha:]] </td>
<td style="text-align:left;"> 非字母</td>
</tr>
<tr>
<td style="text-align:center;">\L </td>
<td style="text-align:left;"> [^[:lower:]] </td>
<td style="text-align:left;"> 非小写字母</td>
</tr>
<tr>
<td style="text-align:center;">\U </td>
<td style="text-align:left;"> [^[:upper:]] </td>
<td style="text-align:left;"> 非大写字母</td>
</tr>
<tr>
<td style="text-align:center;">\S </td>
<td style="text-align:left;"> [^[:space:]] </td>
<td style="text-align:left;"> 非空白字符</td>
</tr>
<tr>
<td style="text-align:center;">\D </td>
<td style="text-align:left;"> [^[:digit:]] </td>
<td style="text-align:left;"> 非十进制数字</td>
</tr>
<tr>
<td style="text-align:center;">\X </td>
<td style="text-align:left;"> [^[:xdigit:]] </td>
<td style="text-align:left;"> 非十六进制数字</td>
</tr>
<tr>
<td style="text-align:center;">\P </td>
<td style="text-align:left;"> [^[:print:]] </td>
<td style="text-align:left;"> 非可打印字符</td>
</tr>
</tbody>
</table>


<p>一些特殊定义:</p>

<p>转义定义: <code>\r</code> (回车), <code>\n</code> (换行), <code>\b</code> (退格), <code>\t</code> (制表符), <code>\v</code> (垂直制表符), <code>\"</code> 和 <code>\'</code></p>

<h1>Regular Express 使用例子</h1>

<p>1) 匹配任何单一字符(ASCII) <code>.</code></p>

<p>2) 匹配行首 <code>^</code>, 例子如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; ls -l <span class="p">|</span> grep <span class="s1">&#39;^d&#39;</span>
</span><span class='line'>drwxr-xr-x <span class="m">6</span> xmq users   <span class="m">4096</span> 10月 <span class="m">12</span> 15:53 Code/
</span><span class='line'>drwxr-xr-x <span class="m">2</span> xmq users   <span class="m">4096</span> 9月  <span class="m">30</span> 02:41 pic/
</span></code></pre></td></tr></table></div></figure>


<p>3) 匹配行尾 <code>$</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>^<span class="nv">$ </span>  ---  匹配空行
</span><span class='line'>^.%  ---  匹配单字符行
</span></code></pre></td></tr></table></div></figure>


<p>4) 匹配重复字符 <code>*</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ro*t  &lt;- 其中 rot, root, rooot 都符合其匹配结果
</span></code></pre></td></tr></table></div></figure>


<p>5) 特殊字符, 需要转义 <code>\</code></p>

<p>6) 匹配一个范围 <code>[]</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>0-9<span class="o">]</span> or <span class="o">[</span>0123456789<span class="o">]</span>       &lt;- 匹配数字
</span><span class='line'><span class="o">[</span>a-zA-Z<span class="o">]</span>                    &lt;- 匹配所有大小写字母
</span><span class='line'><span class="o">[</span>a-zA-Z0-9<span class="o">]</span>                 &lt;- 匹配字母和数字
</span><span class='line'><span class="o">[</span>a-zA-Z<span class="o">]</span>*                   &lt;- 匹配所有单词
</span></code></pre></td></tr></table></div></figure>


<p>注意: 在 <code>[]</code> 中, <code>^</code> 表示否定的意思</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>^A-Za-z<span class="o">]</span>                   &lt;- 匹配非字母
</span><span class='line'><span class="o">[</span>^0-9<span class="o">]</span>                      &lt;- 匹配非数字
</span></code></pre></td></tr></table></div></figure>


<p>7) 匹配重复出现多次 <code>\{\}</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>A<span class="se">\{</span>2<span class="se">\}</span>B                     &lt;- 匹配 AAB
</span><span class='line'>A<span class="se">\{</span>2,<span class="se">\}</span>B                    &lt;- 匹配 AAB AAAB AAAAB ...
</span><span class='line'>A<span class="se">\{</span>2,3<span class="se">\}</span>B                   &lt;- 匹配 AAB AAAB
</span></code></pre></td></tr></table></div></figure>


<h1>参考文档</h1>

<p>1) <a href="http://blog.csdn.net/wklken/article/details/6429526">http://blog.csdn.net/wklken/article/details/6429526</a></p>

<p>2) <a href="http://blog.chinaunix.net/uid-23045379-id-2562051.html">http://blog.chinaunix.net/uid-23045379-id-2562051.html</a></p>

<p>3) <a href="http://blog.csdn.net/a627088424/article/details/15435873">http://blog.csdn.net/a627088424/article/details/15435873</a></p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Portable Operating System Interface, 即可移植操作系统接口, 定义了操作系统应该为应用程序提供的接口标准, 是IEEE为要在各种UNIX操作系统上运行的软件而定义的一系列API标准的总称, 其正式称呼为IEEE 1003, 而国际标准名称为ISO/IEC 9945, 信息来自<a href="http://baike.baidu.com/view/209573.htm?fr=aladdin">百度百科</a><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
</ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-28T05:37:56+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/apache/'>apache</a>, <a class='category' href='/blog/categories/archlinux/'>archlinux</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/mariadb/'>mariadb</a>, <a class='category' href='/blog/categories/mysql/'>mysql</a>, <a class='category' href='/blog/categories/php/'>php</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/28/lamp/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/28/lamp/" itemprop="url">ArchLinux上搭建LAMP环境</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>为了给基于Discuz模板的BBS增加一个小功能而在本地ArchLinux虚拟机里搭建一个BBS的测试平台</p>

<h1>Apache And PHP Installation</h1>

<p>分别安装 apache php 和 php-apache组件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo pacman -S apache php php-apache
</span></code></pre></td></tr></table></div></figure>


<p>启动 apache, <code>sudo systemctl start httpd</code></p>

<p>测试 php 环境</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo vim /srv/http/info.php
</span></code></pre></td></tr></table></div></figure>


<p>在文件中写下如下信息</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nb">phpinfo</span><span class="p">();</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>打开网页测试效果</p>

<p>测试结果未生效, 在 apache 中启用 php</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo vim /etc/httpd/conf/httpd.conf
</span></code></pre></td></tr></table></div></figure>


<p>查找 <code>LoadModule dir_module modules/mod_dir.so</code> 下增加</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>LoadModule php5_module modules/libphp5.so
</span></code></pre></td></tr></table></div></figure>


<p>同时在 <code>Include</code> 列表末尾增加</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Include conf/extra/php5_module.conf
</span></code></pre></td></tr></table></div></figure>


<p>由于在 ArchLinux 中 php-apache 下的 libphp5.so 无法和 mod_mpm_event 一起工作, 会有如下错误</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Apache is running a threaded MPM, but your PHP Module is not compiled to be threadsafe.  You need to recompile PHP.
</span><span class='line'>AH00013: Pre-configuration failed
</span><span class='line'>httpd.service: control process exited, <span class="nv">code</span><span class="o">=</span>exited <span class="nv">status</span><span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<p>有如下两种解决办法:</p>

<p>1) 对 apache php 等重新编译, 启用 thread safety(没试过)</p>

<p>2) 采用替换方法</p>

<p>使用 mod_mpm_prefork, 打开 <code>/etc/httpd/conf/httpd.conf</code>, 把</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>LoadModule mpm_event_module modules/mod_mpm_event.so
</span></code></pre></td></tr></table></div></figure>


<p>替换成</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>LoadModule mpm_prefork_module modules/mod_mpm_prefork.so
</span></code></pre></td></tr></table></div></figure>


<p>重启 apache, <code>sudo systemctl restart httpd</code>, 打开网页测试 <code>info.php</code> 页面, 看到如下画面说明 PHP 启用成功</p>

<p><img src="http://img.vim-cn.com/85/64208227801a398d079fc7e0ffbb874a2e3241.jpg" alt="PHPinfo" /></p>

<h1>Mysql or MariaDB Installation</h1>

<p>安装 Mysql/MariaDB, <code>sudo pacman -S mysql</code></p>

<p>启用 pdo_mysql.so 和 mysqli.so, 打开 <code>sudo vim /etc/php/php.ini</code>, 分别去掉如下两条配置的注释符</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">extension</span><span class="o">=</span>pdo_mysql.so
</span><span class='line'><span class="nv">extension</span><span class="o">=</span>mysqli.so
</span></code></pre></td></tr></table></div></figure>


<p>目前的配置到此结束。</p>

<h1>关于Discuz的配置</h1>

<p>=====增加于 2014/11/4=======</p>

<p>首先把Discuz的文件放置到站点文档目录下, 初步配置一下权限</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo chmod -R <span class="m">744</span> upload/    <span class="p">;</span> 把所有文件文件夹的权限调低
</span><span class='line'>&gt;&gt; sudo chmod -R -x upload
</span><span class='line'>&gt;&gt; sudo chmod -R +x upload      <span class="p">;</span> 这两个命令完成 取消文件的执行权限
</span><span class='line'>&gt;&gt; sudo mv upload/* /sur/http/
</span></code></pre></td></tr></table></div></figure>


<blockquote><p>出现三个问题:</p>

<p>(1) GD库没安装</p>

<p>(2) 文件权限需要重启配置</p>

<p>(3) PHP不能正确连接mysql</p></blockquote>

<p>解决方案</p>

<p>(1) 安装GD库</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo pacman -S php-gd
</span></code></pre></td></tr></table></div></figure>


<p>配置php, 打开 <code>sudo vim /etc/php/php.ini</code>, 取消 <code>extension=gd.so</code></p>

<p>重启apache服务, <code>sudo systemctl retstart httpd</code></p>

<p>(2) 配置文件权限</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo chown -R http:http config
</span><span class='line'>&gt;&gt; sudo chown -R http:http data
</span><span class='line'>&gt;&gt; sudo chown -R http:http uc_client/data/cache
</span><span class='line'>&gt;&gt; sudo chown -R http:http uc_server/data
</span></code></pre></td></tr></table></div></figure>


<p>(3) 检查mysql与php的情况</p>

<p>编辑php.ini, <code>sudo vim /etc/php/php.ini</code>, 确保一下三条处于打开的状态</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">extension</span><span class="o">=</span>mysql.so
</span><span class='line'><span class="nv">extension</span><span class="o">=</span>mysqli.so
</span><span class='line'><span class="nv">extension</span><span class="o">=</span>pdo_mysql.so
</span></code></pre></td></tr></table></div></figure>


<p>此外还要解决数据库初始化的问题</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo mysql_secure_installation
</span><span class='line'>&gt;&gt; sudo systemctl restart mysqld
</span></code></pre></td></tr></table></div></figure>


<h1>参考文献</h1>

<p><a href="https://wiki.archlinux.org/index.php/Apache">https://wiki.archlinux.org/index.php/Apache</a></p>

		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-15T11:46:04+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/debian/'>debian</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/proxy/'>proxy</a>, <a class='category' href='/blog/categories/shadowsocks/'>shadowsocks</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/15/debian-shadowsocks/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/15/debian-shadowsocks/" itemprop="url">Debian上搭建ShadowSocks服务</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>在DigitalOcean上搭建好Droplet后的第一件事就是搭建ShadowSocks服务, 用ShadowSocks翻墙时最受不了的就是服务器失效, 所以最靠谱的就是自己搭建一个</p>

<p>采用ShadowSocks的libev版本, 这个版本的特点是内存占用小(600k左右),使用libev和C编写，低CPU消耗，甚至可以安装在基于OpenWRT的路由器上<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>

<p>这篇博客有借鉴价值, 对于Debian、Ubuntu、Arch等意义并不大, 这个发行版都有源</p>

<h1>Install</h1>

<p>关于之前提到的三个发行版(Debian, Ubuntu, Arch), Debian和Ubuntu的情况差不多, 不过Ubuntu已经很久不玩了, 也不清楚什么状况, Arch相关的安装配置以后补上</p>

<h2>Debian源的配置</h2>

<p>ShadowSocks不在官方源里, 需要额外配置<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo vim /etc/apt/sources.list
</span></code></pre></td></tr></table></div></figure>


<p>按照系统的版本增加源, Debian Wheezy指的是Debian 7</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Debian Wheezy, Ubuntu 12.04 or any distribution with libssl &gt; 1.0.1</span>
</span><span class='line'>deb http://shadowsocks.org/debian wheezy main
</span><span class='line'>
</span><span class='line'><span class="c"># Debian Squeeze, Ubuntu 11.04, or any distribution with libssl &gt; 0.9.8, but &lt; 1.0.0</span>
</span><span class='line'>deb http://shadowsocks.org/debian squeeze main
</span></code></pre></td></tr></table></div></figure>


<p>增加完后更新缓存</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo apt-get update
</span></code></pre></td></tr></table></div></figure>


<h2>Install &amp;&amp; Configure &amp;&amp; Start Service</h2>

<blockquote><p>Debian</p></blockquote>

<p>采用如下命令安装shadowsocks-libev</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo apt-get install shadowsocks
</span></code></pre></td></tr></table></div></figure>


<p>安装完后, 编辑配置文件, 设定监听地址、端口、密码以及加密方式, 然后启动服务</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Edit the configuration</span>
</span><span class='line'>&gt;&gt; sudo vim /etc/shadowsocks/config.json
</span><span class='line'>
</span><span class='line'><span class="c"># Start the service</span>
</span><span class='line'>&gt;&gt; sudo /etc/init.d/shadowsocks start
</span></code></pre></td></tr></table></div></figure>


<h2>检测</h2>

<p>通过如下命令检测服务是否开启</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; ps -ef <span class="p">|</span> grep ss-server <span class="p">|</span> grep -v ps <span class="p">|</span> grep -v grep
</span></code></pre></td></tr></table></div></figure>


<p>也可以检测端口是否被监听来判断</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; netstat -antl
</span></code></pre></td></tr></table></div></figure>


<h1>Configure</h1>

<h2>General</h2>

<p>配置文件的内容如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="s2">&quot;server&quot;</span>:<span class="s2">&quot;my_server_ip&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;server_port&quot;</span>:8388,
</span><span class='line'>    <span class="s2">&quot;local_address&quot;</span>: <span class="s2">&quot;127.0.0.1&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;local_port&quot;</span>:1080,
</span><span class='line'>    <span class="s2">&quot;password&quot;</span>:<span class="s2">&quot;mypassword&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;timeout&quot;</span>:300,
</span><span class='line'>    <span class="s2">&quot;method&quot;</span>:<span class="s2">&quot;aes-256-cfb&quot;</span>,
</span><span class='line'>    <span class="s2">&quot;fast_open&quot;</span>: <span class="nb">false</span>,
</span><span class='line'>    <span class="s2">&quot;workers&quot;</span>: 1
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>其中 <code>server</code> 是ShadowSocks监听的ip, 一般设置成服务器的公网IP; <code>server_port</code> 是ShadowSocks监听的端口, 据说拉低端口号会提高速度, 有一些人比较极端的会设置成443(https的端口); <code>password</code> 应该不用说了; <code>method</code> ShadooSocks支持很多中加密方式, 有些安全但速度比较慢, 有些不太安全但速度快, 看你怎么选择<sup id="fnref:3"><a href="#fn:3" rel="footnote">3</a></sup></p>

<h2>IPV4 And IPV6</h2>

<p>因为在学校里有IPV6的环境, 方便在没有网络的时候可以采用IPV6来上网</p>

<p>如果把 <code>server</code> 设置成服务器的公网IP, 那就只能适用IPV4连接, 如果设置成服务器的IPV6地址, 那就只能IPV6连接, 为此还查了一番, 这个问题比较好解决, 按照这样设置即可 <code>"server": "::"</code></p>

<p>如此设置时的确可以完成同时响应IPV4和IPV6, 但是在查看端口监听的时候只能发现程序监听了IPV6</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; netstat -antl <span class="p">|</span> grep <span class="s2">&quot;server_port&quot;</span>
</span><span class='line'>tcp6       <span class="m">0</span>      <span class="m">0</span> :::2299                 :::*                    LISTEN
</span></code></pre></td></tr></table></div></figure>


<h2>统计流量</h2>

<p>由于我希望同时监听IPV4和IPV6, 而接下来要介绍的方法我不敢保证是否支持这一特性, 同时我也暂时没有时间, 因此没有测试, 仅供参考, 来自于<a href="http://yzs.me/"></a>的<a href="http://yzs.me/2230.html">利用IPTABLES对Shadowsocks统计流量</a></p>

<p>原理: ShadowSocks监听内网地址, 通过iptables的网络转发功能把数据转发到内网地址上来实现</p>

<p>1) 添加一个loop back用的内网IP</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; ifconfig eth0:ss1 10.10.10.10 netmask 255.255.255.0 up
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意:</strong></p>

<ol>
<li><p>网卡名不是eth0的自己修改</p></li>
<li><p>以这种形式增加的内网地址在重启后会失效, 可以修改网卡的配置文件(/etc/network/interfaces或/etc/sysconfig/network-scripts/)添加IP，或者把添加IP的命令加到/etc/rc.local里面</p></li>
</ol>


<p>2) 修改ShadowSocks监听的网络, 并重启 <code>sudo service shadowsocks restart</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;server&quot;</span>:<span class="s2">&quot;10.10.10.10&quot;</span>,
</span></code></pre></td></tr></table></div></figure>


<p>3) 开启系统的IPV4转发功能</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo vim /etc/sysctl.conf
</span></code></pre></td></tr></table></div></figure>


<p>确保 <code>net.ipv4.ip_forward = 1</code> 前没有 <code>#</code></p>

<p>如果有修改, 执行 <code>sudo sysctl -p</code> 使之生效</p>

<p>4) iptables 设置转发</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; iptables -t nat -I PREROUTING -p tcp --dport SERVER_PORT -j DNAT --to-destination 10.10.10.10
</span></code></pre></td></tr></table></div></figure>


<p>5) 设置统计流量</p>

<p>统计内网地址的入网和出网的流量</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; iptables -I INPUT -d 10.10.10.10
</span><span class='line'>&gt;&gt; iptables -I OUTPUT -s 10.10.10.10
</span></code></pre></td></tr></table></div></figure>


<p>查询流量</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; iptables -L -n -v
</span></code></pre></td></tr></table></div></figure>


<p><strong>注意:</strong></p>

<p>这样设置无法清空10.10.10.10的统计数据, 解决办法: 因为加入到FORWARD里面了，不能直接-Z，否则会全部清零，如果要清零单条，最好创建另一个链，把这个记录加入那个链中，再把那个链加入FORWARD中，清零是直接iptables -Z 链名称就行了</p>
<div class="footnotes">
<hr/>
<ol>
<li id="fn:1">
<p>参考自<a href="http://teddysun.com/">秋水逸冰</a>的<a href="http://teddysun.com/358.html">Debian下shadowsocks-libev一键安装脚本</a><a href="#fnref:1" rev="footnote">&#8617;</a></p></li>
<li id="fn:2">
<p>参考自<a href="https://github.com/madeye/shadowsocks-libev">ShadowSocks-libev</a>的<a href="https://github.com/madeye/shadowsocks-libev#install-from-repository">Install from repository</a>, 包括两份版本的Debian和Ubuntu的源<a href="#fnref:2" rev="footnote">&#8617;</a></p></li>
<li id="fn:3">
<p>参考自<a href="https://github.com/clowwindy/shadowsocks#configuration">shadowsocks-libev作者的Github</a>, 里面有具体的说明<a href="#fnref:3" rev="footnote">&#8617;</a></p></li>
</ol>
</div>


		
		
	</div>

</article>


    <article class="post" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
	<div class="meta">
		<div class="date">








  


<time datetime="2014-10-11T10:37:11+00:00" data-updated="true" itemprop="datePublished"></time></div>
		<div class="tags">


	<a class='category' href='/blog/categories/debian/'>debian</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/pptp/'>pptp</a>, <a class='category' href='/blog/categories/vpn/'>vpn</a>


</div>
		
			<span class="comments"><a href="/blog/2014/10/11/debian-vpn/#disqus_thread">Comments</a></span>
		
	</div>
	<h1 class="title" itemprop="name"><a href="/blog/2014/10/11/debian-vpn/" itemprop="url">Debian上开启VPN(PPTP)服务</a></h1>
	<div class="entry-content" itemprop="articleBody">
		<p>有了纽约的服务器貌似必须开启代理模式, 虽然ShadowSocks要比VPN好多了, 但毕竟需要额外的软件或者额外的硬件, 而VPN的客户端却是各种平台上预先搭载的, 因此就有了想搭建VPN的想法, 开动&hellip;..</p>

<p>1.First, 安装pptp的服务端</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; sudo apt-get install pptpd
</span></code></pre></td></tr></table></div></figure>


<p>2.Second, 配置在VPN模式下各主机的IP, <code>localip</code> 指的是VPN模式下PPTP服务器的IP, <code>remoteip</code> 指的是连接到PPTP服务器上的客户端的IP, 通常是一段范围, 编辑文件 <code>sudo vim /etc/pptpd.conf</code>, 在文件最后加上类似代码, 具体参数自定</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>localip 192.168.92.1
</span><span class='line'>remoteip 192.168.92.11-16
</span></code></pre></td></tr></table></div></figure>


<p>3.Third, 编辑PPTP服务器参数, 参照如下参数配置, 编辑文件 <code>sudo vim /etc/pptpd.conf</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>name pptpd
</span><span class='line'>refuse-pap
</span><span class='line'>refuse-chap
</span><span class='line'>refuse-mschap
</span><span class='line'>require-mschap-v2
</span><span class='line'>require-mppe-128
</span><span class='line'>ms-dns 8.8.8.8
</span><span class='line'>ms-dns 8.8.4.4
</span><span class='line'><span class="c">#nodefaultroute</span>
</span><span class='line'><span class="c">#debug</span>
</span><span class='line'><span class="c">#dump</span>
</span><span class='line'>proxyarp
</span><span class='line'>lock
</span><span class='line'>nobsdcomp
</span><span class='line'><span class="c">#nologfd</span>
</span><span class='line'>logfile /var/log/pptpd.log
</span></code></pre></td></tr></table></div></figure>


<p><strong>说明:</strong></p>

<ul>
<li><p>name pptpd：pptpd server的名称</p></li>
<li><p>refuse-pap：拒绝pap身份验证模式</p></li>
<li><p>refuse-chap：拒绝chap身份验证模式</p></li>
<li><p>refuse-mschap：拒绝mschap身份验证模式</p></li>
<li><p>require-mschap-v2：在端点进行连接握手时需要使用微软的mschap-v2进行自身验证</p></li>
<li><p>require-mppe-128：MPPE 模块使用 128 位加密</p></li>
<li><p>ms-dns 8.8.8.8：ppp为Windows客户端提供DNS服务器IP地址，第一个ms-dns为DNS Master，第二个为DNS Slave, 此处选用的DNS是Google的</p></li>
<li><p>proxyarp：建立 ARP 代理键值</p></li>
<li><p>lock：锁定客户端 PTY 设备文件</p></li>
<li><p>nobsdcomp：禁用 BSD 压缩模式</p></li>
<li><p>nologfd：禁止将错误信息记录到标准错误输出设备(stderr)</p></li>
</ul>


<p>4.设置用户, 编辑文件 <code>sudo vim /etc/ppp/chap-secrets</code>, 增加这样的条目 <code>username pptpd password *</code>, 其中 username 和 password 是登录口令, pptpd是服务器上PPTP软件名(默认不动), * 指代接受的IP地址</p>

<p>5.全部搞定后，我们需要重启 pptpd 服务使新配置生效 <code>sudo /etc/init.d/pptpd restart</code></p>

<p>如果这时候尝试连接的话是可以连上的，但是只能访问机器资源，不能上网，想上网的话需要继续配置。</p>

<p>6.配置IPV4的转发</p>

<p>编辑文件 <code>sudo vim /etc/sysctl.conf</code>, 修改信息如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#net.ipv4.ip_forward=1</span>
</span><span class='line'>net.ipv4.ip_forward<span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<p>然后执行 <code>sudo sysctl –p</code> 使得修改生效, 看命令执行后的信息反馈中有无 <code>net.ipv4.ip_forward = 1</code> 这一条</p>

<p>7.防火墙iptable信息转发</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; iptables -t nat -A POSTROUTING -s 192.168.9.0/24 -o eth0 -j MASQUERADE
</span></code></pre></td></tr></table></div></figure>


<p>8.查看端口是否打开</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt; netstat -antl
</span></code></pre></td></tr></table></div></figure>


<hr />

<p>参考资料:</p>

<ol>
<li><p>Linux（VPS+Debian）搭建配置VPN（PPTP）服务 <a href="http://blog.csdn.net/frymgump/article/details/7346840">http://blog.csdn.net/frymgump/article/details/7346840</a></p></li>
<li><p>Debian搭建vpn <a href="http://www.cnblogs.com/timeship/archive/2013/03/09/2951184.html">http://www.cnblogs.com/timeship/archive/2013/03/09/2951184.html</a></p></li>
</ol>


		
		
	</div>

</article>

</div>
<nav id="pagenavi">
    
    
        <a href="2" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    WinterXMQ


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'blog-flower';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
